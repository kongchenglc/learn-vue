# 组件

## 使用组件
### 全局注册
确保在初始化根实例之前注册组件：
```js
Vue.component('my-component', {
  // 选项对象
})
```
### 局部注册
通过实例选项注册仅在单个实例中可用的组件：
```js
var Child = {
  template: '<div>A custom component!</div>',
}

new Vue({
  components: {
    'my-component': Child,
  },
})
```
### data必须是函数
防止组件之间共享数据，导致不可复用：
```js
data: function () {
  return {
    counter: 0
  }
}
```

## prop
父组件通过 prop 给子组件下发数据，子组件通过事件给父组件发送消息。
### prop的使用
在组件的选项对象中定义了`props`属性后，就可以使用其中定义的`prop`了（注意如果js中用驼峰定义prop，html中要转为短线分隔式）:
```html
<div id="example-4">
    <!-- 将message prop赋值为字面量'hello!' -->
    <first-component message='hello!'></first-component>
</div>
```
```js
Vue.component("first-component",{
    props: ['message'],
    template: '<p>first component {{message}}</p>'
})
new Vue({
        el: '#example-4',
        data: {
            picked: ''
        }
    })
```

### 动态语法
将`prop`绑定到父组件的数据上。
```html
<div id="example-4">
    <input type="text" v-model="picked">
    <!-- 和直接给prop赋值不同，这里的"picked"是当作js表达式计算的 -->
    <first-component :message="picked"></first-component>
</div>
```
```js
var vm = Vue.component("first-component",{
    props: ['message'],
    template: '<p>first component {{message}}</p>'
})
new Vue({
        el: '#example-4',
        data: {
            picked: 'aaaa'
        }
    })
```
当要将一个对象的多个属性同时传递的时候，使用不带参数的`v-bind`，对应属性将被赋值：
```html
<todo-item v-bind="todo"></todo-item>
<!-- 等价于 -->
<todo-item
  v-bind:text="todo.text"
  v-bind:is-complete="todo.isComplete"
></todo-item>
```

### 单项数据流
每次父组件有跟新时会更新子组件，**不能在子组件中直接修改**`prop`，会报错。  
下边这两中情况会很需要修改`prop`：
- Prop 作为初始值传入后，子组件想把它当作局部数据来用；
- Prop 作为原始数据传入，由子组件处理成其它数据输出。
这时的处理方法是
1. 创建一个局部变量用`prop`来初始化：
```js
props: ['initialCounter'],
data: function () {
  return { counter: this.initialCounter }
}
```
2. 使用计算属性处理并返回：
```js
props: ['size'],
computed: {
  normalizedSize: function () {
    return this.size.trim().toLowerCase()
  }
}
```
**注意**：引用类型的数据由于是指针，在子组件内部修改会影响父组件状态。\


### prop验证
要为`prop`添加验证，规定其传入的格式，就使用对象的形式定义`prop`，用下面的方法添加验证：
```js
Vue.component('example', {
  props: {
    // 基础类型检测 (`null` 指允许任何类型)
    propA: Number,
    // 可能是多种类型
    propB: [String, Number],
    // 必传且是字符串
    propC: {
      type: String,
      required: true
    },
    // 数值且有默认值
    propD: {
      type: Number,
      default: 100
    },
    // 数组/对象的默认值应当由一个工厂函数返回
    propE: {
      type: Object,
      default: function () {
        return { message: 'hello' }
      }
    },
    // 自定义验证函数
    propF: {
      validator: function (value) {
        return value > 10
      }
    }
  }
})
```

### 非Prop特性
在使用组件的时候添加的属性会渲染到组件的根元素上，一般的属性会替换模板上的属性，`style`和`class`会合并。


## 自定义事件
子组件向父组件通信：子组件使用`v-on`监听事件，使用`$emit`向父组件发送报告（即用$emit触发这个事件，后续参数是会传入事件处理函数），父组件使用`v-on`监听子组件`$emit`发来的报告。
```html
<div id="counter-event-example">
  <p>{{ total }}</p>
  <!-- 监听子组件的通知increament，如果组件有这个通知调用incrementTotal -->
  <button-counter v-on:increment="incrementTotal"></button-counter>
  <button-counter v-on:increment="incrementTotal"></button-counter>
</div>
```
```js
Vue.component('button-counter', {
  template: '<button v-on:click="incrementCounter">{{ counter }}</button>',
  data: function () {
    return {
      counter: 0
    }
  },
  methods: {
    incrementCounter: function () {
      this.counter += 1
      this.$emit('increment')
    }
  },
})

new Vue({
  el: '#counter-event-example',
  data: {
    total: 0
  },
  methods: {
    incrementTotal: function () {
      this.total += 1
    }
  }
})
```
如果子组件的根元素需要监听一个原生事件，要加上修饰符`.native`。


### .sync修饰符
在将数据绑定到`prop`时候，带上修饰符`.sync`，然后子组件使用`this.$emit('update:prop名', 新数据);`的方式更新父组件数据：
```html
<div id="thefather">
    <button>{{total}}</button>
    <zheshi-moban :asdfasdf.sync="total"></zheshi-moban>
    <!-- 会被扩展为下边这样： -->
    <!-- <zheshi-moban :asdfasdf="total" @update:asdfasdf="val => total = val"></zheshi-moban> -->
</div>
```
```js
new Vue({
    el: "#thefather",
    data: {
        total: 0,
    },
    components: {
        'zheshiMoban': {
            template: '<button @click="clicked">{{realdata}}</button>',
            props: ['asdfasdf'],
            data: function() {
                return {
                    realdata: this.asdfasdf,
                }
            },
            methods: {
                clicked: function () {
                    this.realdata++;
                    this.$emit('update:asdfasdf', this.realdata);
                }
            }
        }
    },
})
```

### 使用自定义事件的表单输入组件
